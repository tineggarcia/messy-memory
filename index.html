<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name=“description” content='Messy Memory, a different kind of memory game, memorise cards and position'>
    <meta name="keywords" content="Memory game, mario memoery game">

    <!--Fontawesome and Google Fonts link -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css?family=Raleway%7CRighteous" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="stylesheet" href="assets/css/style.css">
    <title>Messy Memory Game</title>
    <script>


        let array = [1, 2, 3, 4, 5, 6];
        let shuffledArray = array.sort((a, b) => 0.5 - Math.random());

        // sessionStorage.setItem('game_level', 'easy');

        var game_level = sessionStorage.getItem('game_level');
        var easy_level_highscore = localStorage.getItem('easy_level_highscore');
        var hard_level_highscore = localStorage.getItem('hard_level_highscore');
        var expert_level_highscore = localStorage.getItem('expert_level_highscore');
        var easy_level_completed = localStorage.getItem('easy_level_completed')=="Y";
        var hard_level_completed = localStorage.getItem('hard_level_completed')=="Y";
        var expert_level_unlocked = localStorage.getItem('expert_level_unlocked')=="Y";

        var high_score = 0;

        if (game_level == null) {
            game_level = 'easy';
            sessionStorage.setItem('game_level', game_level);
        }

        if (easy_level_highscore == null) {
            easy_level_highscore = '0';
            localStorage.setItem('easy_level_highscore', easy_level_highscore);
        }

        if (hard_level_highscore == null) {
            hard_level_highscore = '0';
            localStorage.setItem('hard_level_highscore', hard_level_highscore);
        }

        if (expert_level_highscore == null) {
            expert_level_highscore = '0';
            localStorage.setItem('expert_level_highscore', expert_level_highscore);
        }

        document.addEventListener('DOMContentLoaded', function () {
            if (expert_level_unlocked) {
                let expert_buttons = document.querySelectorAll(".expert_button");
                for (let expert_button of expert_buttons) {
                    expert_button.style.display="block";
                }
            }
            if (game_level=="easy") {
                document.getElementById("easy_level").style.display = "block";
                document.getElementById("hard_level").style.display = "none";
                document.getElementById("expert_level").style.display = "none";
                array = [1, 2, 3, 4];
                sessionStorage.setItem('high_score', easy_level_highscore);
            } else if (game_level=="hard") {
                document.getElementById("easy_level").style.display="none";
                document.getElementById("hard_level").style.display="block";
                document.getElementById("expert_level").style.display = "none";
                array = [1, 2, 3, 4,5,6];
                sessionStorage.setItem('high_score', hard_level_highscore);
            } else if (game_level=="expert" && expert_level_unlocked) {
                document.getElementById("easy_level").style.display = "none";
                document.getElementById("hard_level").style.display = "none";
                array = [1, 2, 3, 4, 5, 6, 7, 8, 9];
                document.getElementById("expert_level").style.display = "block";
                sessionStorage.setItem('high_score', expert_level_highscore);
            }

            high_score=sessionStorage.getItem("high_score");

            shuffledArray = array.sort((a, b) => 0.5 - Math.random());

            for (let i=0; i<shuffledArray.length; i++) {
                let imgElem = document.getElementById(game_level + "_image"+ (i+1));
                imgElem.src = "assets/images/image" + shuffledArray[i] + ".webp";
            }

            document.getElementById("game_level").innerHTML="Game Mode:" + game_level.toUpperCase();
            document.getElementById("high_score").innerHTML="High Score:" + high_score;
        });

        var countTimer = 10;

        // Update the count down every 1 second
        var gametimer = setInterval(function() {

            // If the count down is over, write some text
            if (countTimer>=0) {
                document.getElementById("timeleft").innerHTML = countTimer;
            }
            if (countTimer <= 0 && countTimer>-2) {
                shuffleImageDivs();
                document.getElementById("timeleft").innerHTML = "Starting in.." + (countTimer+3);
            }
            if (countTimer==-2) {
                var images = document.querySelectorAll(".img_container>img");
                for (let image of images) {
                    image.draggable = true;
                }

                document.getElementById("instruction_box").innerHTML = "Put them back to original position!";
                document.getElementById("timeleft").innerHTML = "Time left:" + (countTimer + 12);
            }
            if (countTimer <=-2) {
                document.getElementById("timeleft").innerHTML = "Time left:" + (countTimer + 12);
            }
            if (countTimer <=-12) {
                clearInterval(gametimer);

                var images = document.querySelectorAll(".img_container>img");
                for (let image of images) {
                    image.draggable = false;
                }
                let myscore = checkOk();
                document.getElementById("instruction_box").innerHTML = "Time's up! Your score is " + myscore;
                document.getElementById("timeleft").innerHTML = "Well Done!!!";
            }

            countTimer--;
        }, 1000);


        function shuffleImageDivs() {
            let reshuffleArray = array.sort((a, b) => 0.5 - Math.random());
            for (let i=0;i<array.length;i++) {
                let image_div = document.getElementById("div_" + game_level + "_image"+(i+1));
                image_div.appendChild(document.getElementById("div_" + game_level + "_image" + (reshuffleArray[i])).firstElementChild);
            }
        }

        function clearImageDivs() {
            let image_divs = document.querySelectorAll(".img_container");
            for (let image_div of image_divs) {
                image_div.style.backgroundImage = "url('assets/images/mariologo.png')";
            }
        }

        function allowDrop(ev) {
            ev.preventDefault();
        }

        function drag(ev) {
            ev.dataTransfer.setData("text", ev.target.id);
            ev.dataTransfer.setData("parent",ev.target.parentElement.id);
        }

        function drop(ev) {
            ev.preventDefault();
            var data = ev.dataTransfer.getData("text");
            var sourceDiv=document.getElementById(ev.dataTransfer.getData("parent"));
            ev.target.parentElement.appendChild(document.getElementById(data));
            sourceDiv.appendChild(ev.target);
        }

        function checkOk() {
            var correctAnswer = 0;
            var check=true;

            const parentElement = document.querySelector("#" + game_level + "_level");
            var images = parentElement.querySelectorAll("img");

            for (let image of images) {
                if (!(image.parentElement.id.endsWith(image.id))) {
                    check=false;
                } else {
                    correctAnswer++;
                    image.src = image.src.replace("images/image","images/ok_image");
                }
            }

            if (correctAnswer>=high_score) {
                alert("Wow! You got the highest score " + correctAnswer + " for " + game_level + "level!!!")
                setHighScore(correctAnswer);
            }

            if (check) {
                // alert("Wowwowwie! You got a perfect score!!! Resetting high score back to zero...");
                localStorage.setItem(game_level + "_level_completed","Y");
                setHighScore(0);
                let enabled = checkIfExpertEnabled();
                if (enabled) {
                    if (localStorage.getItem('expert_level_unlocked') != "Y") {
                        // alert("You unlocked the hidden expert level!!! (1024x screen & up only!");
                        localStorage.setItem('expert_level_unlocked', "Y");
                        setGameLevel("expert");
                    }
                }
            }

            return correctAnswer;
        }

        function setHighScore(score){
            if (score >= high_score) {
                high_score = score;
                localStorage.setItem(game_level + "_level_highscore", high_score);
                document.getElementById("high_score").innerHTML="High Score:" + high_score;
            }
        }

        function setGameLevel(gamelevel) {
            game_level = gamelevel;
            sessionStorage.setItem("game_level", game_level);
            window.location.reload();

        }
        function checkIfExpertEnabled() {
            let enabled=false;
            var easy_level_completed = localStorage.getItem('easy_level_completed')=="Y";
            var hard_level_completed = localStorage.getItem('hard_level_completed')=="Y";

            if (hard_level_completed && easy_level_completed) {
                let wwidth = window.innerWidth;
                let wheight = window.innerHeight;
                if (window.innerWidth>1024) {
                    enabled=true;
                }
            }
            return enabled;
        }
        function clearLocalStorage() {
            localStorage.removeItem('easy_level_highscore');
            localStorage.removeItem('hard_level_highscore');
            localStorage.removeItem('expert_level_highscore');
            localStorage.removeItem('easy_level_completed');
            localStorage.removeItem('hard_level_completed');
            localStorage.removeItem('expert_level_unlocked');
        }

        function clearSessionStorage() {
            sessionStorage.removeItem('game_level');
            sessionStorage.removeItem('high_score');
        }

        function clearStorage() {
            clearSessionStorage();
            clearLocalStorage();
        }

        function showInfo(){
            // alert("To play, wait for timer to finish. Drag images to their original position. Score will be based on total number of images in their original position");
        }

    </script>
</head>
<body>
<div class="container-sm">
    <div class="row">
        <div class="col-1 col-s-1 col-lg-1">
        </div>
        <div class="col-10 col-s-1 col0-lg-10">

            <!--Floating background for the game-->
            <div class="container-sm">
                <div class="row">
                    <div class="col-12">
                        <div class="logo">
                            <img src="assets/images/messymemlogobrown.webp"></img>
                        </div>
                        <div class="score-container">
                            <div class="container-sm">
                                <div class="row">
                                    <div class="col-8"><h4 id="game_level"></h4></div>
                                    <div class="col-4"><h3 id="high_score" class="bg-info  text-white"></h3></div>
                                </div>
                            </div>
                        </div>
                        <div class="game-container">
                            <div class="container">
                                <div class="row">
                                    <div id="easy_level" class="col-8" >
                                        <div class="row easy_drop_div">
                                            <div id="div_easy_image1" class="col-6 img_container easy">
                                                <img id="easy_image1" class="img-thumbnail mx-auto d-block" draggable="false" alt="1" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)"/>
                                            </div>
                                            <div id="div_easy_image2" class="col-6 img_container easy">
                                                <img id="easy_image2" class="img-thumbnail mx-auto d-block" draggable="false" alt="2" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)"/>
                                            </div>
                                        </div>

                                        <div class="row easy_drop_div">
                                            <div id="div_easy_image3" class="col-6 img_container easy">
                                                <img id="easy_image3" class="img-thumbnail mx-auto d-block" draggable="false" alt="3" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)"/>
                                            </div>
                                            <div id="div_easy_image4" class="col-6 img_container easy">
                                                <img id="easy_image4" class="img-thumbnail mx-auto d-block" draggable="false" alt="4" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)"/>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="hard_level" class="col-8">
                                        <div class="row hard_drop_div">
                                            <div id="div_hard_image1" class="col-4 img_container hard">
                                                <img id="hard_image1" class="img-thumbnail mx-auto d-block" draggable="false" alt="4" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)"/>
                                            </div>
                                            <div id="div_hard_image2" class="col-4 img_container hard">
                                                <img id="hard_image2" class="img-thumbnail mx-auto d-block" draggable="false" alt="4" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)"/>
                                            </div>
                                            <div id="div_hard_image3" class="col-4 img_container hard">
                                                <img id="hard_image3" class="img-thumbnail mx-auto d-block" draggable="false" alt="4" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)"/>
                                            </div>
                                        </div>
                                        <div class="row hard_drop_div">
                                            <div id="div_hard_image4" class="col-4 img_container hard">
                                                <img id="hard_image4" class="img-thumbnail mx-auto d-block" draggable="false" alt="4" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)"/>
                                            </div>
                                            <div id="div_hard_image5" class="col-4 img_container hard">
                                                <img id="hard_image5" class="img-thumbnail mx-auto d-block" draggable="false" alt="4" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)"/>
                                            </div>
                                            <div id="div_hard_image6" class="col-4 img_container hard">
                                                <img id="hard_image6" class="img-thumbnail mx-auto d-block" draggable="false" alt="4" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)"/>
                                            </div>
                                        </div>

                                    </div>
                                    <div id="expert_level" class="col-8">
                                        <div class="row expert_drop_div">
                                            <div id="div_expert_image1" class="col-4 img_container expert">
                                                <img id="expert_image1" class="img-thumbnail mx-auto d-block" draggable="false" alt="4" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)"/>
                                            </div>
                                            <div id="div_expert_image2" class="col-4 img_container expert">
                                                <img id="expert_image2" class="img-thumbnail mx-auto d-block" draggable="false" alt="4" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)"/>
                                            </div>
                                            <div id="div_expert_image3" class="col-4 img_container expert">
                                                <img id="expert_image3" class="img-thumbnail mx-auto d-block" draggable="false" alt="4" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)"/>
                                            </div>
                                        </div>
                                        <div class="row expert_drop_div">
                                            <div id="div_expert_image4" class="col-4 img_container expert">
                                                <img id="expert_image4" class="img-thumbnail mx-auto d-block" draggable="false" alt="4" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)"/>
                                            </div>
                                            <div id="div_expert_image5" class="col-4 img_container expert">
                                                <img id="expert_image5" class="img-thumbnail mx-auto d-block" draggable="false" alt="4" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)"/>
                                            </div>
                                            <div id="div_expert_image6" class="col-4 img_container expert">
                                                <img id="expert_image6" class="img-thumbnail mx-auto d-block" draggable="false" alt="4" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)"/>
                                            </div>
                                        </div>
                                        <div class="row expert_drop_div">
                                            <div id="div_expert_image7" class="col-4 img_container expert">
                                                <img id="expert_image7" class="img-thumbnail mx-auto d-block" draggable="false" alt="4" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)"/>
                                            </div>
                                            <div id="div_expert_image8" class="col-4 img_container expert">
                                                <img id="expert_image8" class="img-thumbnail mx-auto d-block" draggable="false" alt="4" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)"/>
                                            </div>
                                            <div id="div_expert_image9" class="col-4 img_container expert">
                                                <img id="expert_image9" class="img-thumbnail mx-auto d-block" draggable="false" alt="4" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)"/>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-4 admin-container">
                                        <div class="container">
                                            <div class="action_button button_container bg-info text-white">
                                                <div class="card-body" onclick="showInfo();">Info</div>
                                            </div>
                                            <div class="action_button button_container bg-primary text-white">
                                                <div class="card-body easy_button" onclick="setGameLevel('easy')">Easy</div>
                                            </div>
                                            <div class="action_button button_container bg-success text-white">
                                                <div class="card-body hard_button" onclick="setGameLevel('hard');">Hard</div>
                                            </div>
                                            <div class="expert_button action_button button_container bg-success text-white">
                                                <div class="card-body hard_button" onclick="setGameLevel('expert');">Expert</div>
                                            </div>
                                            <div class="action_button button_container bg-danger text-white">
                                                <div class="card-body" onclick="clearStorage();setGameLevel('easy');">Reset</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="score-container">
                            <div class="container">
                                <div class="row">
                                    <div class="col-9 "><h3 id="instruction_box" class="bg-info text-success">Remember the cards and their position!</h3></div>
                                    <div class="col-3"><h3 id="timeleft" class="bg-info text-warning"></h3></div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-1 col-s-1 col-lg-1">
    </div>
</div>
</div>
</div>



<script src="assets/js/script.js"></script>
</body>
</html>