<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name=“description” content='Messy Memory, a different kind of memory game, memorise cards and position'>
    <meta name="keywords" content="Memory game, mario memoery game">

    <!--Fontawesome and Google Fonts link -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css?family=Raleway%7CRighteous" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="stylesheet" href="assets/css/style.css">
    <title>Messy Memory Game</title>
    <script>

        let array = [1, 2, 3, 4, 5, 6];
        let shuffledArray = array.sort((a, b) => 0.5 - Math.random());

        sessionStorage.setItem('game_level', 'hard');

        var game_level = sessionStorage.getItem('game_level');
        var easy_level_highscore = localStorage.getItem('easy_level_highscore');
        var hard_level_highscore = localStorage.getItem('hard_level_highscore');

        if (game_level == null) {
            game_level = 'easy';
            sessionStorage.setItem('game_level', game_level);
        }

        if (easy_level_highscore == null) {
            easy_level_highscore = '0';
            localStorage.setItem('easy_level_highscore', easy_level_highscore);
        }

        if (hard_level_highscore == null) {
            hard_level_highscore = '0';
            localStorage.setItem('hard_level_highscore', hard_level_highscore);
        }

        document.addEventListener('DOMContentLoaded', function () {

            if (game_level=="easy") {
                document.getElementById("easy_level").style.display="block";
                document.getElementById("hard_level").style.display="none";
                array = [1, 2, 3, 4];
            } else {
                document.getElementById("easy_level").style.display="none";
                document.getElementById("hard_level").style.display="block";
                array = [1, 2, 3, 4,5,6];
            }

            shuffledArray = array.sort((a, b) => 0.5 - Math.random());

            for (let i=0; i<shuffledArray.length; i++) {
                let imgElem = document.getElementById(game_level + "_image"+ (i+1));
                imgElem.src = "assets/images/image" + shuffledArray[i] + ".webp";

            }
        });

        var countTimer = 10;

        // Update the count down every 1 second
        var gametimer = setInterval(function() {

            // If the count down is over, write some text
            if (countTimer>=0) {
                document.getElementById("timeleft").innerHTML = countTimer;
            }
            if (countTimer <= 0 && countTimer>-2) {
                shuffleImageDivs();
                document.getElementById("timeleft").innerHTML = "Start in.." + (countTimer+3);
            }
            if (countTimer==-2) {
                document.getElementById("instruction_box").innerHTML = "Put them back to original position!";
                document.getElementById("timeleft").innerHTML = "Time left:" + (countTimer + 12);
            }
            if (countTimer <=-2) {
                document.getElementById("timeleft").innerHTML = "Time left:" + (countTimer + 12);
            }
            if (countTimer <=-12) {
                clearInterval(gametimer);
                document.getElementById("instruction_box").innerHTML = "Time is up..";
                document.getElementById("timeleft").innerHTML = "Well Done!!!";
            }

            countTimer--;
        }, 1000);


        function shuffleImageDivs() {
            let reshuffleArray = array.sort((a, b) => 0.5 - Math.random());
            for (let i=0;i<array.length;i++) {
                let image_div = document.getElementById("div_" + game_level + "_image"+(i+1));
                image_div.appendChild(document.getElementById("div_" + game_level + "_image" + (reshuffleArray[i])).firstElementChild);
            }
        }

        function clearImageDivs() {
            let image_divs = document.querySelectorAll(".img_container");
            for (let image_div of image_divs) {
                image_div.style.backgroundImage = "url('assets/images/mariologo.png')";
            }
        }

        function allowDrop(ev) {
            ev.preventDefault();
        }

        function drag(ev) {
            ev.dataTransfer.setData("text", ev.target.id);
            ev.dataTransfer.setData("parent",ev.target.parentElement.id);
        }

        function drop(ev) {
            ev.preventDefault();
            var data = ev.dataTransfer.getData("text");
            var sourceDiv=document.getElementById(ev.dataTransfer.getData("parent"));
            ev.target.parentElement.appendChild(document.getElementById(data));
            sourceDiv.appendChild(ev.target);
            checkOk();
        }

        function checkOk() {
            let check=true;
            let images = document.querySelectorAll("img");
            for (let image of images) {
                if (!(image.parentElement.id.endsWith(image.id))) {
                    check = false;
                }
            }
            if (check) {
                alert("yehey u win!");
            }
        }

    </script>
</head>
<body>
<div class="container">
    <div class="row">
        <div class="col-2">
        </div>
        <div class="col-8 border">

            <!--Floating background for the game-->
            <div class="container">
                <div class="row">
                    <div class="col-1">
                    </div>
                    <div class="col-10 border">
                        <div class="row">
                            <div class="col-12">
                                <div class="logo">
                                    <img src="assets/images/messymemlogobrown.webp"></img>
                                </div>
                                <div class="game-container">
                                    <div id="easy_level" class="container">
                                        <div class="row">
                                            <div class="col-2"></div>
                                            <div class="col-8">

                                                <div class="row easy_drop_div">
                                                    <div id="div_easy_image1" class="col-6 img_container easy">
                                                        <img id="easy_image1" class="img-thumbnail mx-auto d-block" draggable="true" alt="1" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)"/>
                                                    </div>
                                                    <div id="div_easy_image2" class="col-6 img_container easy">
                                                        <img id="easy_image2" class="img-thumbnail mx-auto d-block" draggable="true" alt="2" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)"/>
                                                    </div>
                                                </div>

                                                <div class="row easy_drop_div">
                                                    <div id="div_easy_image3" class="col-6 img_container easy">
                                                        <img id="easy_image3" class="img-thumbnail mx-auto d-block" draggable="true" alt="3" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)"/>
                                                    </div>
                                                    <div id="div_easy_image4" class="col-6 img_container easy">
                                                        <img id="easy_image4" class="img-thumbnail mx-auto d-block" draggable="true" alt="4" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)"/>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-2"></div>
                                        </div>
                                    </div>
                                    <div id="hard_level" class="container">
                                        <div class="row">
                                            <div class="col-1"></div>
                                            <div class="col-10">
                                                <div class="row hard_drop_div">
                                                    <div id="div_hard_image1" class="col-4 img_container hard">
                                                        <img id="hard_image1" class="img-thumbnail mx-auto d-block" draggable="true" alt="4" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)"/>
                                                    </div>
                                                    <div id="div_hard_image2" class="col-4 img_container hard">
                                                        <img id="hard_image2" class="img-thumbnail mx-auto d-block" draggable="true" alt="4" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)"/>
                                                    </div>
                                                    <div id="div_hard_image3" class="col-4 img_container hard">
                                                        <img id="hard_image3" class="img-thumbnail mx-auto d-block" draggable="true" alt="4" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)"/>
                                                    </div>
                                                </div>
                                                <div class="row hard_drop_div">
                                                    <div id="div_hard_image4" class="col-4 img_container hard">
                                                        <img id="hard_image4" class="img-thumbnail mx-auto d-block" draggable="true" alt="4" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)"/>
                                                    </div>
                                                    <div id="div_hard_image5" class="col-4 img_container hard">
                                                        <img id="hard_image5" class="img-thumbnail mx-auto d-block" draggable="true" alt="4" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)"/>
                                                    </div>
                                                    <div id="div_hard_image6" class="col-4 img_container hard">
                                                        <img id="hard_image6" class="img-thumbnail mx-auto d-block" draggable="true" alt="4" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)"/>
                                                    </div>
                                                </div>

                                            </div>
                                            <div class="col-1"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-1 p-2 bg-gray text-red text-center">
                                    <span>
                                        <h3 id="instruction_box">Remember the cards and their position!</h3>
                                        <p class="h2" id="timeleft"></p>
                                    </span>
                                </div>


                            </div>
                        </div>
                    </div>
                    <div class="col-1">
                    </div>
                </div>
            </div>
        </div>
        <div class="col-2">
        </div>
    </div>
</div>



<script src="assets/js/script.js"></script>
</body>
</html>